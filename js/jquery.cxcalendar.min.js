/*!
 * cxCalendar 1.1
 * date: 2012-01-14
 * https://github.com/ciaoca/cxCalendar
 * (c) 2012 Ciaoca, http://ciaoca.com/
 */
(function(e){e.fn.cxCalendar=function(t,n){if(this.length<1)return;t=e.extend({},e.cxCalendar.defaults,t),n=e.extend({},e.cxCalendar.language,n);var r=this;r.val().length>0&&(t.date=r.val(),t.date=t.date.replace(/\./g,"/"),t.date=t.date.replace(/-/g,"/"),t.date=t.date.replace(/\//g,"/"),t.date=Date.parse(t.date)),t.date=new Date(t.date),isNaN(t.date.getFullYear())&&(t.date=new Date),t.date.setHours(0),t.date.setMinutes(0),t.date.setSeconds(0);var i=t.date.getFullYear(),s=t.date.getMonth()+1,o=t.date.getDate(),u=function(e){return e%4==0&&e%100!=0||e%400==0?1:0},a=new Array(31,28+u(i),31,30,31,30,31,31,30,31,30,31),f=n.week_list,l=6-t.wday,c=7-t.wday>=7?0:7-t.wday,h,p,d,v,m,g;h=e("<div></div>",{"class":"cxcalendar"}),p=e("<div></div>",{"class":"date_hd"}).appendTo(h),v=e("<table></table>").appendTo(h);var y,b,w;p.html("<a class='date_pre' href='javascript://' rel='pre'>&lt;</a><a class='date_next' href='javascript://' rel='next'>&gt;</a>"),y=e("<div></div>",{"class":"date_txt"}).appendTo(p),d=e("<div></div>",{"class":"date_set"}).appendTo(p),g="";for(var E=t.begin_year;E<=t.end_year;E++)g+="<option value='"+E+"'>"+E+"</option>";b=e("<select></select>",{"class":"year_set"}).html(g).appendTo(d).val(i),d.append(" - "),g="";for(var E=0;E<12;E++)g+="<option value='"+(E+1)+"'>"+n.month_list[E]+"</option>";w=e("<select></select>",{"class":"month_set"}).html(g).appendTo(d).val(s),g="<thead><tr>";for(var E=0;E<7;E++)g+="<th class='",E==l?g+=" sat":E==c&&(g+=" sun"),g+="'>",g+=E+t.wday<7?f[E+t.wday]:f[E+t.wday-7],g+="</th>";g+="</tr></thead>",g+="<tbody></tbody>",v.html(g),h.appendTo("body"),m=e("<div></div>").css({display:"none",position:"absolute",top:"0",left:"0",background:"#fff",opacity:"0","z-index":"999"}).appendTo("body");var S=function(){var e=document.body.clientWidth,t=document.body.clientHeight,i=h.outerWidth(),s=h.outerHeight(),o=r.offset().top,u=r.offset().left,a=r.outerWidth(),f=r.outerHeight();o=o+s+f>t?o-s:o+f,u=u+i>e?u-(i-a):u,y.html("<span class='y'>"+b.val()+"</span>"+n.year+"<span class='m'>"+n.month_list[w.val()-1]+"</span>"+n.month),h.css({top:o,left:u}).show(),m.css({width:e,height:t}).show()},x=function(e,i){i<1?(e--,i=12):i>12&&(e++,i=1);var s=i;i--,e<t.begin_year?e=t.end_year:e>t.end_year&&(e=t.begin_year),a[1]=28+u(e),g="";var o=new Date(e,i,1),f=new Date;f.setHours(0),f.setMinutes(0),f.setSeconds(0);var h=new Date;h.setHours(0),h.setMinutes(0),h.setSeconds(0),h=r.val(),h=h.replace(/\./g,"/"),h=h.replace(/-/g,"/"),h=h.replace(/\//g,"/"),h=new Date(Date.parse(h)),isNaN(h.getFullYear())&&(h=null);var p=o.getDay()-t.wday<0?o.getDay()-t.wday+7:o.getDay()-t.wday,d=Math.ceil((a[i]+p)/7),m,E,S,x;for(var T=0;T<d;T++){g+="<tr>";for(var N=0;N<7;N++)m=T*7+N,E=m-p+1,E=E<=0||E>a[i]?"":m-p+1,g+="<td",typeof E=="number"&&(S=null,x=null,o=new Date(e,i,E),S=Date.parse(f)-Date.parse(o),x=Date.parse(h)-Date.parse(o),g+=" title='"+e+t.hyphen+s+t.hyphen+E+"' class='num",x==0?g+=" selected":S==0?g+=" now":N==l?g+=" sat":N==c&&(g+=" sun"),g+="'"),g+=" data-day='"+E+"'>"+E+"</td>";g+="</tr>"}v.find("tbody").html(g),y.html("<span class='y'>"+e+"</span>"+n.year+"<span class='m'>"+n.month_list[i]+"</span>"+n.month),b.val(e),w.val(i+1)},T=function(e){var n,i;n=w.val(),i=e,t.type=="yyyy-mm-dd"&&(n="0"+w.val(),i="0"+e,n=n.substr(n.length-2,n.length),i=i.substr(i.length-2,i.length)),r.val(b.val()+t.hyphen+n+t.hyphen+i),N()},N=function(){h.hide(),m.hide(),d.hide(),y.show()};h.delegate("a","click",function(){if(!this.rel)return;var e=this.rel;switch(e){case"pre":x(b.val(),parseInt(w.val(),10)-1);break;case"next":x(b.val(),parseInt(w.val(),10)+1);break;case"clear":r.val(""),x(i,s),N()}}),v.delegate("td","click",function(){var t=e(this);t.hasClass("num")&&(v.find("td").removeClass("selected"),t.addClass("selected"),T(t.data("day")))}),r.bind("click",S),m.bind("click",N),y.bind("click",function(){y.hide(),d.show()}),b.bind("change",function(){x(b.val(),w.val())}),w.bind("change",function(){x(b.val(),w.val())}),x(i,s)},e.cxCalendar={defaults:{begin_year:1950,end_year:2030,date:new Date,type:"yyyy-mm-dd",hyphen:"-",wday:0},language:{year:"\u5e74",month:"\u6708",month_list:["1","2","3","4","5","6","7","8","9","10","11","12"],week_list:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"]}}})(jQuery);